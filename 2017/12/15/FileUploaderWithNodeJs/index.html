<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    
    <title>File Uploader With NodeJs | Dandan Rhapsody | 紀錄一些技術/瑣事</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="javascript,nodejs,uploadFile,upload,Csrf,xhr">
    <link rel="shortcut icon" href="/img/favicons.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css" />
    <link rel="stylesheet" href="/css/style.css?v=1.4.1">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	false,
            lv: JSON.parse('{"enable":true,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":true,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"dandanXO","repo":"gitment","oauth":{"client_id":"03d79e26c1ae2b6081a3","client_secret":"bbcc8d0e56be3034b326e92235ef2ca69928b229"},"perPage":2}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatars.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Dandan</h5>
          <a href="mailto:dandanxo.1996@gmail.com" title="dandanxo.1996@gmail.com" class="mail">
            
              <span>d</span>
            
              <span>a</span>
            
              <span>n</span>
            
              <span>d</span>
            
              <span>a</span>
            
              <span>n</span>
            
              <span>x</span>
            
              <span>o</span>
            
              <span>.</span>
            
              <span>1</span>
            
              <span>9</span>
            
              <span>9</span>
            
              <span>6</span>
            
              <span>@</span>
            
              <span>g</span>
            
              <span>m</span>
            
              <span>a</span>
            
              <span>i</span>
            
              <span>l</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/dandanXO" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                ABOUT
              </a>
            </li>
        
            <li class="">
              <a href="https://www.cakeresume.com/91daf4" target="_blank" >
                <i class="icon icon-lg icon-plus-square"></i>
                Resume
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/dandanXO" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>File Uploader With NodeJs</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="https://i.imgur.com/OLJxbaR.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">File Uploader With NodeJs</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-12-15T02:56:13.000Z" itemprop="datePublished" class="page-time">
  2017-12-15
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/nodejs/">nodejs</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-FileUploaderWithNodeJs"
    class="post-article article-type-post" itemprop="blogPost">
      <div class="post-card">
          <h1 class="post-card-title">File Uploader With NodeJs</h1>
          <div class="post-meta">
              <time class="post-time" title="2017-12-15 10:56:13" datetime="2017-12-15T02:56:13.000Z"  itemprop="datePublished">2017-12-15</time>

              
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/nodejs/">nodejs</a></li></ul>



              
	<span id="/2017/12/15/FileUploaderWithNodeJs/" class="leancloud_visitors" data-flag-title="File Uploader With NodeJs" title="File Uploader With NodeJs">
		
			<i class="icon icon-eye"></i>
		
		<span class="leancloud-visitors-count"></span>
	</span>
 

              
    <span class="leancloud-comment">
        <i class="icon icon-comment-o"></i>
        <a href="/2017/12/15/FileUploaderWithNodeJs/#comment">
            <span class="valine-comment-count" data-xid="/2017/12/15/FileUploaderWithNodeJs/"></span>
        </a>
    </span>



              
          </div>
          <div class="post-content" id="post-content" itemprop="postContent">
              
              <h1 id="File-Uploader-With-NodeJs-一些紀錄與坑"><a href="#File-Uploader-With-NodeJs-一些紀錄與坑" class="headerlink" title="File Uploader With NodeJs 一些紀錄與坑"></a>File Uploader With NodeJs 一些紀錄與坑</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>想要做一個可以上傳檔案到伺服器的基礎網站一些歷程記錄。</p>
<h2 id="前置準備"><a href="#前置準備" class="headerlink" title="前置準備"></a>前置準備</h2><p>這當中會用到 <a href="https://github.com/felixge/node-formidable" target="_blank" rel="noopener">formidable</a>模組，可以先行安裝</p>
<p><code>npm install express formidable --save</code></p>
<h2 id="The-Front-End"><a href="#The-Front-End" class="headerlink" title="The Front End"></a>The Front End</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><p>簡單的前端使用bootstrap 就行了 在 <em>views/</em> 之中<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>File Uploader - coligo.io<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">'https://fonts.googleapis.com/css?family=Raleway'</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> <span class="attr">type</span>=<span class="string">'text/css'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"css/styles.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-12"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-cloud-upload"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>File Uploader<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h4</span>&gt;</span>coligo.io<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"progress"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"progress-bar"</span> <span class="attr">role</span>=<span class="string">"progressbar"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-lg upload-btn"</span> <span class="attr">type</span>=<span class="string">"button"</span>&gt;</span>Upload File<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"upload-input"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"uploads[]"</span> <span class="attr">multiple</span>=<span class="string">"multiple"</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-2.2.0.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"javascripts/upload.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><code>&lt;input id=&quot;upload-input&quot; type=&quot;file&quot; name=&quot;uploads[]&quot; multiple=&quot;multiple&quot;&gt;</code></p>
<p>這行需要特別注意 <em>type=”file”</em>  將會時做出一個選擇檔案的按鈕用來上傳。</p>
<figure class="image-box">
                <a rel=File Uploader With NodeJs href="https://coligo.io/building-ajax-file-uploader-with-node/file-input-box.png" title="imgur" data-fancybox="images"><img src="https://coligo.io/building-ajax-file-uploader-with-node/file-input-box.png" alt="imgur" title="" class=""></a>
                <p>imgur</p>
            </figure>
<p><code>multiple=&quot;multiple</code> 可以更改決定上船是否為單一或是多個檔案。</p>
<p>接著先將上面的<code>&lt;input id=&quot;upload-input&quot; type=&quot;file&quot; name=&quot;uploads[]&quot; multiple=&quot;multiple&quot;&gt;</code>使用CSS隱藏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#upload-input &#123;</span><br><span class="line">  display: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因為後面會使用端的javascirpt來操作他。</p>
<h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><p>在 <em>public/css/</em> 之中創建CSS如底下:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.btn</span><span class="selector-pseudo">:focus</span>, <span class="selector-class">.upload-btn</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">  <span class="attribute">outline</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#4791D2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'Raleway'</span>, sans-serif;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.row</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">80px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.upload-btn</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#F89406</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.upload-btn</span><span class="selector-pseudo">:hover</span>,</span><br><span class="line"><span class="selector-class">.upload-btn</span><span class="selector-pseudo">:focus</span>,</span><br><span class="line"><span class="selector-class">.upload-btn</span><span class="selector-pseudo">:active</span>,</span><br><span class="line"><span class="selector-class">.upload-btn</span><span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#FA8900</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h4</span> &#123;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#B8BDC1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.glyphicon</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">5em</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#9CA3A9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#68757E</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.panel</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#upload-input</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.main-container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (min-width: <span class="number">992px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">450px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="javascript"><a href="#javascript" class="headerlink" title="javascript"></a>javascript</h3><p>前面樣式與面綁調整好之後接下來就是使用者端javascript的邏輯部分，先解決剛剛隱藏掉的upload按鈕如下:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.upload-btn'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">'#upload-input'</span>).click();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>然後因為有處理進度條的 <em>%數</em> 需要重置因此如下:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.upload-btn'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">'#upload-input'</span>).click();</span><br><span class="line">    $(<span class="string">'.progress-bar'</span>).text(<span class="string">'0%'</span>);</span><br><span class="line">    $(<span class="string">'.progress-bar'</span>).width(<span class="string">'0%'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>接下來是最重要的上傳邏輯部分 <em>#uplaod-input</em> 改變時做出將檔案使用陣列與key/value方式整理好如下:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#upload-input'</span>).on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> files = $(<span class="keyword">this</span>).get(<span class="number">0</span>).files;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (files.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="comment">// One or more files selected, process the file upload</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// create a FormData object which will be sent as the data payload in the</span></span><br><span class="line">    <span class="comment">// AJAX request</span></span><br><span class="line">    <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// loop through all the selected files</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> file = files[i];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// add the files to formData object for the data payload</span></span><br><span class="line">      formData.append(<span class="string">'uploads[]'</span>, file, file.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>緊接著 AJAX request 使用POST方法送到我們 /upload 的endpoint:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  url: &apos;/upload&apos;,</span><br><span class="line">  type: &apos;POST&apos;,</span><br><span class="line">  data: formData,</span><br><span class="line">  processData: false,</span><br><span class="line">  contentType: false,</span><br><span class="line">  success: function(data)&#123;</span><br><span class="line">      console.log(&apos;upload successful!&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注意賈有使用Csrf做認證的話需要以下而外的東西</p>
<ol>
<li>getCsrfToken的函數:<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCsrfToken</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">var</span> metas = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'input'</span>); </span><br><span class="line">        </span><br><span class="line">          <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;metas.length; i++) &#123; </span><br><span class="line">            <span class="keyword">if</span> (metas[i].getAttribute(<span class="string">"name"</span>) == <span class="string">"_csrf"</span>) &#123; </span><br><span class="line">                <span class="built_in">console</span>.log(metas[i].getAttribute(<span class="string">"name"</span>))</span><br><span class="line">               <span class="keyword">return</span> metas[i].getAttribute(<span class="string">"value"</span>); </span><br><span class="line">            &#125; </span><br><span class="line">          &#125; </span><br><span class="line">  </span><br><span class="line">          <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<ol>
<li>在headers加入認證header:<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> csrf = getCsrfToken();</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">...</span><br><span class="line">headers: &#123;</span><br><span class="line">        <span class="string">'_csrf'</span>:csrf,</span><br><span class="line">        <span class="string">'X-CSRF-Token'</span>: csrf</span><br><span class="line">    &#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>基本上這樣上傳邏輯就完成了，下面是要控制 <em>progress-bar</em> 的 callback:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">xhr: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// create an XMLHttpRequest</span></span><br><span class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// listen to the 'progress' event</span></span><br><span class="line">  xhr.upload.addEventListener(<span class="string">'progress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (evt.lengthComputable) &#123;</span><br><span class="line">      <span class="comment">// calculate the percentage of upload completed</span></span><br><span class="line">      <span class="keyword">var</span> percentComplete = evt.loaded / evt.total;</span><br><span class="line">      percentComplete = <span class="built_in">parseInt</span>(percentComplete * <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// update the Bootstrap progress bar with the new percentage</span></span><br><span class="line">      $(<span class="string">'.progress-bar'</span>).text(percentComplete + <span class="string">'%'</span>);</span><br><span class="line">      $(<span class="string">'.progress-bar'</span>).width(percentComplete + <span class="string">'%'</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// once the upload reaches 100%, set the progress bar text to done</span></span><br><span class="line">      <span class="keyword">if</span> (percentComplete === <span class="number">100</span>) &#123;</span><br><span class="line">        $(<span class="string">'.progress-bar'</span>).html(<span class="string">'Done'</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> xhr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最後整個js檔案會像這樣裡面我自己有一些註解的debug用程式碼:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.upload-btn'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">'#upload-input'</span>).click();</span><br><span class="line">    $(<span class="string">'.progress-bar'</span>).text(<span class="string">'0%'</span>);</span><br><span class="line">    $(<span class="string">'.progress-bar'</span>).width(<span class="string">'0%'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">'#upload-input'</span>).on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> files = $(<span class="keyword">this</span>).get(<span class="number">0</span>).files;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (files.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="comment">// create a FormData object which will be sent as the data payload in the</span></span><br><span class="line">    <span class="comment">// AJAX request</span></span><br><span class="line">    <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// loop through all the selected files and add them to the formData object</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> file = files[i];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// add the files to formData object for the data payload</span></span><br><span class="line">      formData.append(<span class="string">'uploads[]'</span>, file, file.name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getCsrfToken</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">var</span> metas = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'input'</span>); </span><br><span class="line">        </span><br><span class="line">          <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;metas.length; i++) &#123; </span><br><span class="line">            <span class="keyword">if</span> (metas[i].getAttribute(<span class="string">"name"</span>) == <span class="string">"_csrf"</span>) &#123; </span><br><span class="line">                <span class="built_in">console</span>.log(metas[i].getAttribute(<span class="string">"name"</span>))</span><br><span class="line">               <span class="keyword">return</span> metas[i].getAttribute(<span class="string">"value"</span>); </span><br><span class="line">            &#125; </span><br><span class="line">          &#125; </span><br><span class="line">  </span><br><span class="line">          <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> csrf = getCsrfToken();</span><br><span class="line">     <span class="comment">// console.log(csrf)</span></span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">      url: <span class="string">'/account/upload'</span>,</span><br><span class="line">      type: <span class="string">'POST'</span>,</span><br><span class="line">      data: formData ,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'_csrf'</span>:csrf,</span><br><span class="line">        <span class="string">'X-CSRF-Token'</span>: csrf</span><br><span class="line">    &#125;,</span><br><span class="line">      processData: <span class="literal">false</span>,</span><br><span class="line">      contentType: <span class="literal">false</span>,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'upload successful!\n'</span> + data);</span><br><span class="line">          </span><br><span class="line">      &#125;,</span><br><span class="line">      error: <span class="function"><span class="keyword">function</span> (<span class="params">xhr, ajaxOptions, thrownError</span>) </span>&#123; </span><br><span class="line">        <span class="comment">//Add these parameters to display the required response</span></span><br><span class="line">        <span class="comment">//alert(xhr.status);</span></span><br><span class="line">        <span class="comment">//console.log(xhr.responseText);</span></span><br><span class="line">    &#125;,</span><br><span class="line">      xhr: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// create an XMLHttpRequest</span></span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// listen to the 'progress' event</span></span><br><span class="line">        xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line">        xhr.upload.addEventListener(<span class="string">'progress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (evt.lengthComputable) &#123;</span><br><span class="line">            <span class="comment">// calculate the percentage of upload completed</span></span><br><span class="line">            <span class="keyword">var</span> percentComplete = evt.loaded / evt.total;</span><br><span class="line">            percentComplete = <span class="built_in">parseInt</span>(percentComplete * <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// update the Bootstrap progress bar with the new percentage</span></span><br><span class="line">            $(<span class="string">'.progress-bar'</span>).text(percentComplete + <span class="string">'%'</span>);</span><br><span class="line">            $(<span class="string">'.progress-bar'</span>).width(percentComplete + <span class="string">'%'</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// once the upload reaches 100%, set the progress bar text to done</span></span><br><span class="line">            <span class="keyword">if</span> (percentComplete === <span class="number">100</span>) &#123;</span><br><span class="line">              $(<span class="string">'.progress-bar'</span>).html(<span class="string">'Done'</span>);</span><br><span class="line">              alert(<span class="string">'upload successful!\n'</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//console.log(xhr.getAllResponseHeaders());</span></span><br><span class="line">        <span class="keyword">return</span> xhr;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h1 id="The-Back-End-Processing-the-Upload"><a href="#The-Back-End-Processing-the-Upload" class="headerlink" title="The Back End: Processing the Upload"></a>The Back End: Processing the Upload</h1><p>後端基本上就比較簡單了，這裡就不贅述<a href="expressjs.com">expressjs</a>的用法直接貼上完整的server.js</p>
<p>很多情況後端不會這麼簡單需要自行修改。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> formidable = <span class="built_in">require</span>(<span class="string">'formidable'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">  res.sendFile(path.join(__dirname, <span class="string">'views/index.html'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/upload'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create an incoming form object</span></span><br><span class="line">  <span class="keyword">var</span> form = <span class="keyword">new</span> formidable.IncomingForm();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// specify that we want to allow the user to upload multiple files in a single request</span></span><br><span class="line">  form.multiples = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// store all uploads in the /uploads directory</span></span><br><span class="line">  form.uploadDir = path.join(__dirname, <span class="string">'/uploads'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// every time a file has been uploaded successfully,</span></span><br><span class="line">  <span class="comment">// rename it to it's orignal name</span></span><br><span class="line">  form.on(<span class="string">'file'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">field, file</span>) </span>&#123;</span><br><span class="line">    fs.rename(file.path, path.join(form.uploadDir, file.name));</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// log any errors that occur</span></span><br><span class="line">  form.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'An error has occured: \n'</span> + err);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// once all the files have been uploaded, send a response to the client</span></span><br><span class="line">  form.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      res.cookie(<span class="string">'fileName'</span>,fileName)</span><br><span class="line">      res.end(<span class="string">'/uploads/News/'</span>+fileName);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// parse the incoming request containing the form data</span></span><br><span class="line">  form.parse(req);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Server listening on port 3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>

          </div>
          
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最後更新時間：<time datetime="2018-02-21T03:11:33.301Z" itemprop="dateUpdated">2018-02-21 11:11:33</time>
</span><br>


        
        轉載，原文地址：<a href="/2017/12/15/FileUploaderWithNodeJs/" target="_blank" rel="external">https://dandanxo.github.io/2017/12/15/FileUploaderWithNodeJs/</a>
        
    </div>
    <footer>
        <a href="https://dandanxo.github.io">
            <img src="/img/avatars.jpg" alt="Dandan">
            Dandan
        </a>
    </footer>
</blockquote>

          
          <div class="post-footer">
              
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Csrf/">Csrf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/upload/">upload</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/uploadFile/">uploadFile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xhr/">xhr</a></li></ul>

              <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://dandanxo.github.io/2017/12/15/FileUploaderWithNodeJs/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《File Uploader With NodeJs》 — Dandan Rhapsody&url=https://dandanxo.github.io/2017/12/15/FileUploaderWithNodeJs/&via=https://dandanxo.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://dandanxo.github.io/2017/12/15/FileUploaderWithNodeJs/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

          </div>
          
              
    <div id="comment"></div>



          
      </div>
      
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2018/01/23/RESTfulAPIbynodejsexpress實戰/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">RESTful API by node jsexpress 紀錄</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2017/12/08/Promise學習筆記/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Promise 筆記</h4>
      </a>
    </div>
  
</nav>


      
      
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目錄</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#File-Uploader-With-NodeJs-一些紀錄與坑"><span class="post-toc-number">1.</span> <span class="post-toc-text">File Uploader With NodeJs 一些紀錄與坑</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前置準備"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">前置準備</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#The-Front-End"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">The Front End</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HTML"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">HTML</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CSS"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">CSS</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#javascript"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">javascript</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#The-Back-End-Processing-the-Upload"><span class="post-toc-number">2.</span> <span class="post-toc-text">The Back End: Processing the Upload</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
  </article>
  
  
</div>

        <footer class="footer">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://www.lujingtao.com" target="_blank">HOME</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                Dandan &copy; 2015 - 2020
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            
            <span>
	            Hosted by <a href="https://coding.net/pages" target="_blank">Coding Pages</a>
            </span>
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://dandanxo.github.io/2017/12/15/FileUploaderWithNodeJs/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《File Uploader With NodeJs》 — Dandan Rhapsody&url=https://dandanxo.github.io/2017/12/15/FileUploaderWithNodeJs/&via=https://dandanxo.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://dandanxo.github.io/2017/12/15/FileUploaderWithNodeJs/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKklEQVR42u3aQXLjMAwEwPz/095rDpE8A8pbZbJ5cjmOyNYBBRD4+YnX69e6+ubq91e/bJ/5wMLAwPhaxut2Xf1mBXNPut/3ckcMDIwDGFeHuP98j0nYV9/kZ8PAwMBIPt+Hy3t8+8owMDAwkm3y5C9PHJPgi4GBgZGHzpVrtTbIfqQWx8DA+EJGfuv+/z9/pL+BgYHxVYxXuZ4KlPkFXPQcDAyMrRl5gEvK0bYkXgm4GBgYGElRmnxzf6C2FVpkrxgYGBsx8m1mwbEdL0v+94+/YmBgHM+4T+naVkHeYChiKQYGxtaMWX6VFKWzFunsIg8DA+MERntN316ErY+FRbtjYGBsyqgTr9Ehnrrau3w+BgbG1ozZwERCzcN0y4hamBgYGMcw2sclR88bDG1oxsDAOJNxHwRXMO21XT0zgoGBsRFjdk3fNgZmL6UAY2BgbM1Y32DWjGwTx2hhYGAcwGgbA0+9gpVyGgMD42RGPu7QFq6z0jcK2RgYGAcwZgFxNi62MhD2ZtgCAwPjAEZ76TarLvPAXYx6YGBgHMmY1YmzRDB/QW+KWAwMjO0Yr3LlxecsZXwsKcTAwNiIsdLmbDdYGRSbjXdgYGDsxMgDaF70zgYsZhd5GBgY5zDawJccrh0Xa0/7R8DFwMDAKMcv2nQzT0Y/HnAxMDC2YDwbZPMGw5siFgMDY2tG2wzIw2seoPMWKQYGxmmMpdKxbB6sFMAPNDIxMDC+j/EPCN+yUDCGCZ0AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.4.1"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.4.1"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.4.1"></script>
<script type="text/javascript" src="/js/blog.js?v=1.4.1"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.4.1"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
        <script type="text/javascript" src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script type="text/javascript" src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script type="text/javascript" src="/js/plugins/valine.js?v=1.4.1"></script>
    
    



<script type="text/javascript" src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
<script type="text/javascript" src="/js/plugins/leancloud_visitors.js?v=1.4.1"></script>



    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>




    <script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = '回來繼續看啦！';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)咦!又好了!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>





    
</body>
</html>
